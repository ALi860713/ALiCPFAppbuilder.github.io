<!DOCTYPE html>
<head>
<title>CPF-Coaster</title>

<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="./style.css">

</head>
<body>
<div class="container">
	<div id="value-field">
			<img class="value-icon" src="./images/thermometer.png" />
			<span id="test"></span>
			<span id="temp" class="value-number">750℃</span><br>
			<img class="value-icon2" src="./images/Weighing.png" />
			<span id="weight" class="value-number2">1234 c.c</span>
	</div>

	<div id="cup-field">
		<img id="cup1" class="cup-icon" src="./images/cup_empty.png" />
		<img id="cup2" class="cup-icon" src="./images/cup_full.png" />
		<img id="cup3" class="cup-icon" src="./images/cup_full.png" />
		<img id="cup4" class="cup-icon" src="./images/cup_full.png" />
		<img id="cup5" class="cup-icon" src="./images/cup_full.png" />
	</div>
	<span class="cup-value"><font color="#3CB9A6" id="cup_value">1600</font> ml</span>

</div>

<script>
	
	setup();
	
	var temp;
	var now_press;
	var prev_press;
	var drink_press;
	var total = 0;
	var drinktime;
	
	setInterval(loop, 1000);
	
	function loop() {
	
		temp = cpf.get("socket a1");
		now_press = cpf.get("socket a0");
		now_press = now_press * 2;
		
		document.getElementById("test").innerHTML = temp;
		document.getElementById("temp").innerHTML = toCelsius(temp) + '℃';
		document.getElementById("weight").innerHTML = now_press + '公克';
		
		if (now_press == 0) {
			drink_press = prev_press;
			drinktime = Date.now();
		} else {
			if (Date.now() - drinktime >= 3000) {
				if (now_press < drink_press) {
					total += drink_press - now_press;
				}
				drinktime = Date.now();
				drink_press = now_press;
			}
		}
		
		prev_press = now_press;
		
		if(total >= 2000) {
			document.getElementById("cup1").src = './images/cup_empty.png';
			document.getElementById("cup2").src = './images/cup_empty.png';
			document.getElementById("cup3").src = './images/cup_empty.png';
			document.getElementById("cup4").src = './images/cup_empty.png';
			document.getElementById("cup5").src = './images/cup_empty.png';
		} else if(total >= 1600) {
			document.getElementById("cup1").src = './images/cup_empty.png';
			document.getElementById("cup2").src = './images/cup_empty.png';
			document.getElementById("cup3").src = './images/cup_empty.png';
			document.getElementById("cup4").src = './images/cup_empty.png';
			document.getElementById("cup5").src = './images/cup_full.png';
		} else if(total >= 1200) {
			document.getElementById("cup1").src = './images/cup_empty.png';
			document.getElementById("cup2").src = './images/cup_empty.png';
			document.getElementById("cup3").src = './images/cup_empty.png';
			document.getElementById("cup4").src = './images/cup_full.png';
			document.getElementById("cup5").src = './images/cup_full.png';
		} else if(total >= 800) {
			document.getElementById("cup1").src = './images/cup_empty.png';
			document.getElementById("cup2").src = './images/cup_empty.png';
			document.getElementById("cup3").src = './images/cup_full.png';
			document.getElementById("cup4").src = './images/cup_full.png';
			document.getElementById("cup5").src = './images/cup_full.png';
		} else if(total >= 400) {
			document.getElementById("cup1").src = './images/cup_empty.png';
			document.getElementById("cup2").src = './images/cup_full.png';
			document.getElementById("cup3").src = './images/cup_full.png';
			document.getElementById("cup4").src = './images/cup_full.png';
			document.getElementById("cup5").src = './images/cup_full.png';
		} else {
			document.getElementById("cup1").src = './images/cup_full.png';
			document.getElementById("cup2").src = './images/cup_full.png';
			document.getElementById("cup3").src = './images/cup_full.png';
			document.getElementById("cup4").src = './images/cup_full.png';
			document.getElementById("cup5").src = './images/cup_full.png';
		}
		
		document.getElementById("cup_value").innerHTML = total;
		
	}
		
	function toCelsius(value) {
		var steinhart = value / 10000.0;
		steinhart = Math.log(steinhart);
		steinhart = steinhart / 3950.0;
		steinhart += 1.0 / (25 + 273.15);
		steinhart = 1.0 / steinhart;
		steinhart -= 273.15;
			
		return steinhart;
	}
	
	// cpf setup
	function setup(){
		if(cpf)
			var ret = cpf.setPinMode('["resetPin"],["setPinMode", "analog", 0, "INPUT"],["setPinMode", "analog", 1, "INPUT"]');
		
	}

</script>

</body>
</html>